# FIXME: Find a way we can test the whole playbook rather than just
# the role. Either make sure we're not in a play here and use
# import_playbook, or spawn an ansible-playbook subprocess? The latter
# might be actually a more precise way to test the real end-user
# experience.

- name: Network tasks
  block:
    - vars:
      # This expression should export all osm_ workloads
      # skipping the universal conversion host (osm_uch)
      # which is used to move the VM's.
      # We create it on in seed.yml but we dont export it.
        os_migrate_networks_filter:
          - regex: '^osm_(?!uch)'

    - name: load exported data
    - name: verify data contents
    - {}
- name: Subnet tasks
  block:
    - vars:
      # This expression should export all osm_ workloads
      # skipping the universal conversion host (osm_uch)
      # which is used to move the VM's.
      # We create it on in seed.yml but we dont export it.
        os_migrate_subnets_filter:
          - regex: '^osm_(?!uch)'

    - name: load exported data
    - name: verify data contents
    - {}
- name: Security group tasks
  block:
    - vars:
        os_migrate_security_groups_filter:
          - regex: '^osm_'

    - name: load exported data
    - name: verify data contents
    - {}
- name: Security group rules tasks
  block:
    - vars:
        os_migrate_security_groups_filter:
          - regex: '^osm_'

    - name: load exported data
    - name: verify data contents
    - {}
- name: Router tasks
  block:
    - vars:
      # This expression should export all osm_ workloads
      # skipping the universal conversion host (osm_uch)
      # which is used to move the VM's.
      # We create it on in seed.yml but we dont export it.
        os_migrate_routers_filter:
          - regex: '^osm_(?!uch)'

    - name: load exported data
    - name: verify data contents
    - {}
- name: Router interface tasks
  block:
    - vars:
      # This expression should export all osm_ workloads
      # skipping the universal conversion host (osm_uch)
      # which is used to move the VM's.
      # We create it on in seed.yml but we dont export it.
        os_migrate_routers_filter:
          - regex: '^osm_(?!uch)'

    - name: load exported data
    - name: verify data contents
    - {}
- name: Image tasks
  block:
    - vars:
        os_migrate_images_filter:
          - regex: '^osm_'

    - name: load exported data
    - name: verify data contents
    - {}
