

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OS Migrate Walkthrough &mdash; os-migrate  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuring variables in os-migrate" href="configuring-variables.html" />
    <link rel="prev" title="Installation" href="install-from-galaxy.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> os-migrate
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../devel/README.html">OS-Migrate Developer Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">OS-Migrate User Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install-from-source.html">Installation from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="install-from-galaxy.html">Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">OS Migrate Walkthrough</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authentication">Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameter-file">Parameter file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shortcuts">Shortcuts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pre-workload-migration">Pre-workload migration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#export-and-import">Export and import</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#workload-migration">Workload migration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#process-summary">Process summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conversion-host-deployment">Conversion host deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#migration">Migration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuring-variables.html">Configuring variables in os-migrate</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#general-usage-notes">General usage notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../roles.html">Documented roles in os-migrate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Documented modules in os-migrate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">os-migrate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="README.html">OS-Migrate User Documentation</a> &raquo;</li>
        
      <li>OS Migrate Walkthrough</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user/walkthrough.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="os-migrate-walkthrough">
<h1>OS Migrate Walkthrough<a class="headerlink" href="#os-migrate-walkthrough" title="Permalink to this headline">¶</a></h1>
<p>OS Migrate is a framework for OpenStack parallel cloud migration
(migrating content between OpenStack tenants which are not necessarily
in the same cloud). It’s a collection of Ansible playbooks that provide
the basic functionality, but may not fit each use case out of the box.
You can craft custom playbooks using the OS-Migrate collection pieces
(roles and modules) as building blocks.</p>
<p>Parallel cloud migration is a way to modernize an OpenStack deployment.
Instead of upgrading an OpenStack cluster in place, a second OpenStack
cluster is deployed alongside, and tenant content is migrated from the
original cluster to the new one. Parallel cloud migration is best suited
for environments which are due for a hardware refresh cycle. It may also
be performed without a hardware refresh, but extra hardware resources
are needed to bootstrap the new cluster. As hardware resources free up
in the original cluster, they can be gradually added to the new cluster.</p>
<p>OS-Migrate strictly uses the official OpenStack API and does not utilize
direct database access or other methods to export or import data. The
Ansible playbooks contained in OS-Migrate are idempotent. If a command
fails, you can retry with the same command.</p>
<div class="figure align-default" id="id1">
<img alt="OSP-OSP Migration Overview" src="https://raw.githubusercontent.com/os-migrate/os-migrate/main/media/walkthrough/2020-06-24-osp-migrate-fig1.png?sanitize=true" />
<p class="caption"><span class="caption-text">OSP-OSP Migration Overview</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>The migration is generally performed in this sequence:</p>
<ul class="simple">
<li><p>prerequisites: authentication, parameter files,</p></li>
<li><p>pre-workload migration, which copies applicable resources into the
destination cloud (e.g. networks, security groups, images) while
workloads keep running in the source cloud,</p></li>
<li><p>workload migration, which stops usage of applicable resources in the
source cloud and moves them into the destination cloud (VMs,
volumes).</p></li>
</ul>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="section" id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h3>
<p>Users are encouraged to use os-migrate using specific credentials for
each project/tenant, this means not using the admin user to execute the
resources migration. In the case that a user is required to use the
admin credentials this <code class="docutils literal notranslate"><span class="pre">admin</span></code> user needs to have access to the tenant
resources, otherwise you will hit an error similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">keystoneauth1</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">Unauthorized</span><span class="p">:</span> <span class="n">The</span> <span class="n">request</span> <span class="n">you</span> <span class="n">have</span> <span class="n">made</span> <span class="n">requires</span> <span class="n">authentication</span><span class="o">.</span> <span class="p">(</span><span class="n">HTTP</span> <span class="mi">401</span><span class="p">)</span>
</pre></div>
</div>
<p>To pass this error there are some options.</p>
<ul class="simple">
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">admin</span></code> user as a <code class="docutils literal notranslate"><span class="pre">_member_</span></code> of each project.</p></li>
</ul>
<p>Depending on how many projects need to be migrated this approach seems
to be suboptimal as there are involved several configuration updates in
the projects that will need to be reverted after the migration
completes.</p>
<ul class="simple">
<li><p>Create a group including the admin user and add the group to each
project as member.</p></li>
</ul>
<p>The difference with this approach is that once the migration is
completed, by removing the group, all the references in all the projects
will be removed automatically.</p>
</div>
<div class="section" id="parameter-file">
<h3>Parameter file<a class="headerlink" href="#parameter-file" title="Permalink to this headline">¶</a></h3>
<p>Let’s create an <code class="docutils literal notranslate"><span class="pre">os-migrate-vars.yml</span></code> file with Ansible variables:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">os_migrate_src_auth</span><span class="p">:</span>
  <span class="nt">auth_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://192.168.0.13.199/v3</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">srcpassword</span>
  <span class="nt">project_domain_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Default</span>
  <span class="nt">project_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src</span>
  <span class="nt">user_domain_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Default</span>
  <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src</span>
<span class="nt">os_migrate_src_region_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">regionOne</span>
<span class="nt">os_migrate_dst_auth</span><span class="p">:</span>
  <span class="nt">auth_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://192.167.0.16:5000/v3</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dstpassword</span>
  <span class="nt">project_domain_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Default</span>
  <span class="nt">project_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dst</span>
  <span class="nt">user_domain_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Default</span>
  <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dst</span>
<span class="nt">os_migrate_dst_region_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">regionOne</span>

<span class="nt">os_migrate_data_dir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/migrator/os-migrate-data</span>
</pre></div>
</div>
<p>The file contains the source and destination tenant credentials, a
directory on the migrator host (typically localhost) and a directory
where the exported data will be saved. There can also</p>
<div class="section" id="a-note-about-keystone-v2">
<h4>A note about Keystone v2<a class="headerlink" href="#a-note-about-keystone-v2" title="Permalink to this headline">¶</a></h4>
<p>As depicted in content of the previously defined <code class="docutils literal notranslate"><span class="pre">os-migrate-vars.yml</span></code>
file, the parameters <code class="docutils literal notranslate"><span class="pre">os_migrate_src_auth</span></code> and <code class="docutils literal notranslate"><span class="pre">os_migrate_dst_auth</span></code>
refer to the usage of Keystone v3. In the case of a user needing to
execute a migration between tenants not supporting Keystone v3 the
following error will be raised:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">keystoneauth1</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">discovery</span><span class="o">.</span><span class="n">DiscoveryFailure</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">use</span> <span class="n">v2</span> <span class="n">authentication</span> <span class="k">with</span> <span class="n">domain</span> <span class="n">scope</span>
</pre></div>
</div>
<p>To fix this issue, the user must adjust their auth parameters in this
way:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">os_migrate_src_auth</span><span class="p">:</span>
  <span class="nt">auth_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://192.168.0.13.199/v2.0</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">srcpassword</span>
  <span class="nt">project_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src</span>
  <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src</span>
<span class="nt">os_migrate_src_region_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">regionOne</span>
</pre></div>
</div>
<p>Notice that the parameters <code class="docutils literal notranslate"><span class="pre">project_domain_id</span></code> and <code class="docutils literal notranslate"><span class="pre">user_domain_id</span></code>
do not exist and the <code class="docutils literal notranslate"><span class="pre">auth_url</span></code> parameter points to the Keystone v2
endpoint.</p>
</div>
</div>
<div class="section" id="shortcuts">
<h3>Shortcuts<a class="headerlink" href="#shortcuts" title="Permalink to this headline">¶</a></h3>
<p>We will use the OS Migrate collection path and an ansible-playbook
command with the following arguments routinely, so let’s save them as
variables in the shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">OSM_DIR</span><span class="o">=</span>/home/migrator/.ansible/collections/ansible_collections/os_migrate/os_migrate
<span class="nb">export</span> <span class="nv">OSM_CMD</span><span class="o">=</span><span class="s2">&quot;ansible-playbook -v -i </span><span class="nv">$OSM_DIR</span><span class="s2">/localhost_inventory.yml -e @os-migrate-vars.yml&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pre-workload-migration">
<h2>Pre-workload migration<a class="headerlink" href="#pre-workload-migration" title="Permalink to this headline">¶</a></h2>
<p>Workloads require the support of several resources in a given cloud to
operate properly. Some of these resources include networks, subnets,
routers, router interfaces, security groups, and security group rules.
The pre-workload migration process includes exporting these resources
from the source cloud onto the migrator machine, the option to edit the
resources if desired, and importing them into the destination cloud.</p>
<p>Exporting or importing resources is enabled by running the corresponding
playbook from OS Migrate. Let’s look at a concrete example. To export
the networks, run the “export_networks” playbook.</p>
<div class="section" id="export-and-import">
<h3>Export and import<a class="headerlink" href="#export-and-import" title="Permalink to this headline">¶</a></h3>
<p>To export the networks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/export_networks.yml
</pre></div>
</div>
<p>This will create networks.yml file in the data directory, similar to
this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">os_migrate_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.4.0</span>
<span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">_info</span><span class="p">:</span>
      <span class="nt">availability_zones</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">nova</span>
      <span class="nt">created_at</span><span class="p">:</span> <span class="s">&#39;2020-04-07T14:08:30Z&#39;</span>
      <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">a1eb31f6-2cdc-4896-b582-8950dafa34aa</span>
      <span class="nt">project_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2f444c71265048f7a9d21f81db6f21a4</span>
      <span class="nt">qos_policy_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">revision_number</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="nt">status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ACTIVE</span>
      <span class="nt">subnet_ids</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">a5052e10-5e00-432b-a826-29695677aca0</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">d450ffd0-972e-4398-ab49-6ba9e29e2499</span>
      <span class="nt">updated_at</span><span class="p">:</span> <span class="s">&#39;2020-04-07T14:08:34Z&#39;</span>
    <span class="nt">params</span><span class="p">:</span>
      <span class="nt">availability_zone_hints</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
      <span class="nt">description</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
      <span class="nt">dns_domain</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">is_admin_state_up</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">is_default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">is_port_security_enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">is_router_external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="nt">is_shared</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="nt">is_vlan_transparent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">mtu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1450</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osm_net</span>
      <span class="nt">provider_network_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">provider_physical_network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">provider_segmentation_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">qos_policy_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">segments</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack.network.Network</span>
</pre></div>
</div>
<p>You may edit the file as needed and then run the “import_networks”
playbook to import the networks from this file into the destination
cloud:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/import_networks.yml
</pre></div>
</div>
<p>You can repeat this process for other resources like subnets, security
groups, security group rules, routers, router interfaces, images and
keypairs.</p>
<p>For a full list of available playbooks, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls <span class="nv">$OSM_DIR</span>/playbooks
</pre></div>
</div>
<div class="figure align-default" id="id2">
<img alt="Pre-workload Migration (data flow)" src="https://raw.githubusercontent.com/os-migrate/os-migrate/main/media/walkthrough/2020-06-24-osp-migrate-fig2.png?raw=true" />
<p class="caption"><span class="caption-text">Pre-workload Migration (data flow)</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id3">
<img alt="Pre-workload Migration (workflow)" src="https://raw.githubusercontent.com/os-migrate/os-migrate/main/media/walkthrough/2020-06-24-osp-migrate-fig3.png?raw=true" />
<p class="caption"><span class="caption-text">Pre-workload Migration (workflow)</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>Pre-workload migration recorded demo:</p>
<p><a class="reference external" href="https://youtu.be/e7KXy5Hq4CMA"><img alt="Watch the video1" src="https://img.youtube.com/vi/e7KXy5Hq4CM/maxresdefault.jpg" /></a></p>
</div>
</div>
<div class="section" id="workload-migration">
<h2>Workload migration<a class="headerlink" href="#workload-migration" title="Permalink to this headline">¶</a></h2>
<p>Workload information is exported in a similar method to networks,
security groups, etc. as in the previous sections. Run the
“export_workloads” playbook, and edit the resulting workloads.yml as
desired:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">os_migrate_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.4.0</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">_info</span><span class="p">:</span>
    <span class="nt">addresses</span><span class="p">:</span>
      <span class="nt">external_network</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">OS-EXT-IPS-MAC:mac_addr</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fa:16:3e:98:19:a0</span>
        <span class="l l-Scalar l-Scalar-Plain">OS-EXT-IPS:type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fixed</span>
        <span class="nt">addr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.19.2.41</span>
        <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="nt">flavor_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">a96b2815-3525-4eea-9ab4-14ba58e17835</span>
    <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0025f062-f684-4e02-9da2-3219e011ec74</span>
    <span class="nt">status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SHUTOFF</span>
  <span class="nt">params</span><span class="p">:</span>
    <span class="nt">flavor_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.small</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">migration-vm</span>
    <span class="nt">security_group_names</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">testing123</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack.compute.Server</span>
</pre></div>
</div>
<p>Note that this playbook only extracts metadata about instances in the
specified tenant - it does not download OpenStack volumes directly to
the migration data directory. Data transfer is handled by the
import_workloads playbook, and it is a fairly involved process to create
an environment where this playbook will run successfully. The next few
sections detail the process and some of the rationale for various design
choices.</p>
<div class="section" id="process-summary">
<h3>Process summary<a class="headerlink" href="#process-summary" title="Permalink to this headline">¶</a></h3>
<p>This flowchart illustrates the high-level migration workflow, from a
user’s point of view:</p>
<div class="figure align-default" id="id4">
<img alt="alt text" src="https://raw.githubusercontent.com/os-migrate/os-migrate/main/media/walkthrough/2020-06-24-osp-migrate-fig4.png?raw=true" />
<p class="caption"><span class="caption-text">alt text</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>The process involves the deployment of a “conversion host” on source and
destination clouds. A conversion host is an OpenStack instance which
will be used to transfer binary volume data from the source to the
destination cloud. Currently, CentOS 8 is expected to be the image from
which conversion hosts are created.</p>
<p>The following diagram helps explain the need for a conversion host VM:</p>
<div class="figure align-default" id="id5">
<img alt="Workload migration (data flow)" src="https://raw.githubusercontent.com/os-migrate/os-migrate/main/media/walkthrough/2020-06-24-osp-migrate-fig5.png?raw=true" />
<p class="caption"><span class="caption-text">Workload migration (data flow)</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>This shows that volumes on the source and destination clouds are removed
from their original VMs and attached to their respective UCH, and then
transferred over the network from the source UCH to the destination. The
tooling inside the UCH migrates one instance by automating these actions
on the source and destination clouds:</p>
<p>Source Cloud:</p>
<ul class="simple">
<li><p>Detach volumes from the target instance to migrate</p></li>
<li><p>Attach the volumes to the source conversion host</p></li>
<li><p>Export the volumes as block devices and wait for destination
conversion host to connect</p></li>
</ul>
<p>Destination Cloud:</p>
<ul class="simple">
<li><p>Create new volumes on the destination conversion host, one for each
source volume</p></li>
<li><p>Attach the new volumes to the destination conversion host</p></li>
<li><p>Connect to the block devices exported by source conversion host, and
copy the data to the new attached volumes</p></li>
<li><p>Detach the volumes from the destination conversion host</p></li>
<li><p>Create a new instance using the new volumes</p></li>
</ul>
<p>This method keeps broad compatibility with the various flavors and
configurations of OpenStack using as much of an API-only approach as
possible, while allowing the use of libguestfs-based tooling to minimize
total data transfer.</p>
</div>
<div class="section" id="preparation">
<h3>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h3>
<p>We’ll put additional parameters into <code class="docutils literal notranslate"><span class="pre">os-migrate-vars.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">os_migrate_conversion_external_network_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">public</span>
<span class="nt">os_migrate_conversion_flavor_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.large</span>
</pre></div>
</div>
<p>These define the flavor and external network we want to use for our
conversion hosts.</p>
<p>By default the migration will use an image named <code class="docutils literal notranslate"><span class="pre">os_migrate_conv</span></code> for
conversion hosts. Make sure this image exists in Glance on both clouds.
Currently it should be a <a class="reference external" href="https://cloud.centos.org/centos/8/x86_64/images/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2">CentOS 8 cloud
image</a>.</p>
</div>
<div class="section" id="conversion-host-deployment">
<h3>Conversion host deployment<a class="headerlink" href="#conversion-host-deployment" title="Permalink to this headline">¶</a></h3>
<p>The conversion host deployment playbook creates the instances, installs
additional required packages, and authorizes the destination conversion
host to connect to the source conversion host for the actual data
transfer.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/deploy_conversion_hosts.yml
</pre></div>
</div>
</div>
<div class="section" id="migration">
<h3>Migration<a class="headerlink" href="#migration" title="Permalink to this headline">¶</a></h3>
<p>Before migrating workloads, the destination cloud must have imported all
other resources (networks, security groups, etc.) or the migration will
fail. Matching named resources (including flavor names) must exist on
the destination before the instances are created.</p>
<p>If not already exported, export workload information with the
export_workloads playbook. Each instance listed in the resulting
workloads.yml will be migrated, except for the one matching the name
given to the source conversion host instance.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/export_workloads.yml
</pre></div>
</div>
<p>Then run the import_workloads playbook:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/import_workloads.yml
</pre></div>
</div>
<p>After a few minutes, results should start showing up looking something
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PLAY</span> <span class="p">[</span><span class="n">migrator</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">Gathering</span> <span class="n">Facts</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="p">[</span><span class="n">DEPRECATION</span> <span class="n">WARNING</span><span class="p">]:</span> <span class="n">Distribution</span> <span class="n">fedora</span> <span class="mi">31</span> <span class="n">on</span> <span class="n">host</span> <span class="n">localhost</span> <span class="n">should</span> <span class="n">use</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span><span class="p">,</span> <span class="n">but</span> <span class="ow">is</span> <span class="n">using</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span> <span class="k">for</span> <span class="n">backward</span> <span class="n">compatibility</span> <span class="k">with</span> <span class="n">prior</span> <span class="n">Ansible</span> <span class="n">releases</span><span class="o">.</span> <span class="n">A</span> <span class="n">future</span> <span class="n">Ansible</span> <span class="n">release</span> <span class="n">will</span> <span class="n">default</span> <span class="n">to</span> <span class="n">using</span> <span class="n">the</span>
<span class="n">discovered</span> <span class="n">platform</span> <span class="n">python</span> <span class="k">for</span> <span class="n">this</span> <span class="n">host</span><span class="o">.</span> <span class="n">See</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="o">.</span><span class="n">ansible</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ansible</span><span class="o">/</span><span class="mf">2.9</span><span class="o">/</span><span class="n">reference_appendices</span><span class="o">/</span><span class="n">interpreter_discovery</span><span class="o">.</span><span class="n">html</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> <span class="n">This</span> <span class="n">feature</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">version</span> <span class="mf">2.12</span><span class="o">.</span> <span class="n">Deprecation</span> <span class="n">warnings</span> <span class="n">can</span> <span class="n">be</span> <span class="n">disabled</span> <span class="n">by</span> <span class="n">setting</span> <span class="n">deprecation_warnings</span><span class="o">=</span><span class="kc">False</span> <span class="ow">in</span> <span class="n">ansible</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span>
<span class="n">ok</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">validate</span> <span class="n">loaded</span> <span class="n">resources</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="n">ok</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">stop</span> <span class="n">when</span> <span class="n">errors</span> <span class="n">found</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="n">skipping</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">read</span> <span class="n">workloads</span> <span class="n">resource</span> <span class="n">file</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="n">ok</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">get</span> <span class="n">source</span> <span class="n">conversion</span> <span class="n">host</span> <span class="n">address</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="n">ok</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">check</span> <span class="n">source</span> <span class="n">conversion</span> <span class="n">host</span> <span class="n">status</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="n">skipping</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">get</span> <span class="n">destination</span> <span class="n">conversion</span> <span class="n">host</span> <span class="n">address</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="n">ok</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">check</span> <span class="n">destination</span> <span class="n">conversion</span> <span class="n">host</span> <span class="n">status</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="n">skipping</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="kn">import</span> <span class="nn">workloads</span><span class="p">]</span> <span class="o">********************************************************************************************************************</span>
<span class="n">changed</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;addresses&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;external_network&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;OS-EXT-IPS-MAC:mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fa:16:3e:98:19:a0&#39;</span><span class="p">,</span> <span class="s1">&#39;OS-EXT-IPS:type&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="s1">&#39;10.19.2.41&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]},</span> <span class="s1">&#39;flavor_id&#39;</span><span class="p">:</span> <span class="s1">&#39;a96b2815-3525-4eea-9ab4-14ba58e17835&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;0025f062-f684-4e02-9da2-3219e011ec74&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;SHUTOFF&#39;</span><span class="p">},</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flavor_name&#39;</span><span class="p">:</span> <span class="s1">&#39;m1.small&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;migration-vm&#39;</span><span class="p">,</span> <span class="s1">&#39;security_group_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;testing123&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;openstack.compute.Server&#39;</span><span class="p">})</span>
<span class="n">changed</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;addresses&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;external_network&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;OS-EXT-IPS-MAC:mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fa:16:3e:d7:ae:16&#39;</span><span class="p">,</span> <span class="s1">&#39;OS-EXT-IPS:type&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="s1">&#39;10.19.2.50&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]},</span> <span class="s1">&#39;flavor_id&#39;</span><span class="p">:</span> <span class="s1">&#39;a96b2815-3525-4eea-9ab4-14ba58e17835&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;0ca7b7d6-6679-4d46-99e5-866672d3e869&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;SHUTOFF&#39;</span><span class="p">},</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flavor_name&#39;</span><span class="p">:</span> <span class="s1">&#39;m1.small&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;second-migration-vm&#39;</span><span class="p">,</span> <span class="s1">&#39;security_group_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;openstack.compute.Server&#39;</span><span class="p">})</span>
<span class="n">skipping</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;addresses&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;external_network&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;OS-EXT-IPS-MAC:mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fa:16:3e:14:12:46&#39;</span><span class="p">,</span> <span class="s1">&#39;OS-EXT-IPS:type&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="s1">&#39;10.19.2.39&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]},</span> <span class="s1">&#39;flavor_id&#39;</span><span class="p">:</span> <span class="s1">&#39;d0c1507e-92ce-48c5-9287-59c7b4e57467&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;240d0194-ee2a-4708-b2c1-bde082887c59&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;ACTIVE&#39;</span><span class="p">},</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flavor_name&#39;</span><span class="p">:</span> <span class="s1">&#39;ims.conversion-host&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;source-conversion-host-2&#39;</span><span class="p">,</span> <span class="s1">&#39;security_group_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;openstack.compute.Server&#39;</span><span class="p">})</span>
<span class="n">changed</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;addresses&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;external_network&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;OS-EXT-IPS-MAC:mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fa:16:3e:06:3e:c2&#39;</span><span class="p">,</span> <span class="s1">&#39;OS-EXT-IPS:type&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="s1">&#39;10.19.2.44&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]},</span> <span class="s1">&#39;flavor_id&#39;</span><span class="p">:</span> <span class="s1">&#39;a96b2815-3525-4eea-9ab4-14ba58e17835&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;980e76f6-9143-475d-89f8-e708342b90e2&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;SHUTOFF&#39;</span><span class="p">},</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flavor_name&#39;</span><span class="p">:</span> <span class="s1">&#39;m1.small&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;fourth-migration-vm&#39;</span><span class="p">,</span> <span class="s1">&#39;security_group_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;openstack.compute.Server&#39;</span><span class="p">})</span>
<span class="n">skipping</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;addresses&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;external_network&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;OS-EXT-IPS-MAC:mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fa:16:3e:3a:9b:72&#39;</span><span class="p">,</span> <span class="s1">&#39;OS-EXT-IPS:type&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="s1">&#39;10.19.2.40&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]},</span> <span class="s1">&#39;flavor_id&#39;</span><span class="p">:</span> <span class="s1">&#39;d0c1507e-92ce-48c5-9287-59c7b4e57467&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;ce4dda96-5d8e-4b67-aee2-9845cdc943fe&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;ACTIVE&#39;</span><span class="p">},</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flavor_name&#39;</span><span class="p">:</span> <span class="s1">&#39;ims.conversion-host&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;latestuci&#39;</span><span class="p">,</span> <span class="s1">&#39;security_group_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;openstack.compute.Server&#39;</span><span class="p">})</span>
<span class="n">skipping</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;addresses&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;external_network&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;OS-EXT-IPS-MAC:mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fa:16:3e:3d:d1:25&#39;</span><span class="p">,</span> <span class="s1">&#39;OS-EXT-IPS:type&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="s1">&#39;10.19.2.37&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]},</span> <span class="s1">&#39;flavor_id&#39;</span><span class="p">:</span> <span class="s1">&#39;d0c1507e-92ce-48c5-9287-59c7b4e57467&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;a4e688e4-8d22-4469-9535-a8c867797c61&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;ACTIVE&#39;</span><span class="p">},</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flavor_name&#39;</span><span class="p">:</span> <span class="s1">&#39;ims.conversion-host&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;source-conversion-host-&#39;</span><span class="p">,</span> <span class="s1">&#39;security_group_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;openstack.compute.Server&#39;</span><span class="p">})</span>

<span class="n">PLAY</span> <span class="n">RECAP</span> <span class="o">********************************************************************************************************************</span>
<span class="n">localhost</span>                  <span class="p">:</span> <span class="n">ok</span><span class="o">=</span><span class="mi">6</span>    <span class="n">changed</span><span class="o">=</span><span class="mi">1</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>    <span class="n">skipped</span><span class="o">=</span><span class="mi">3</span>    <span class="n">rescued</span><span class="o">=</span><span class="mi">0</span>    <span class="n">ignored</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>Any instance marked “changed” should be successfully migrated to the
destination cloud. Instances are “skipped” if they are still running, or
if they match the name or ID of the specified conversion host. If there
is already an instance on the destination matching the name of the
current instance, it will be marked “ok” and no extra work will be
performed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TASK</span> <span class="p">[</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="kn">import</span> <span class="nn">workloads</span><span class="p">]</span> <span class="o">******************************************************************************************************************</span>
<span class="n">ok</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;addresses&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;external_network&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;OS-EXT-IPS-MAC:mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fa:16:3e:98:19:a0&#39;</span><span class="p">,</span> <span class="s1">&#39;OS-EXT-IPS:type&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="s1">&#39;10.19.2.41&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]},</span> <span class="s1">&#39;flavor_id&#39;</span><span class="p">:</span> <span class="s1">&#39;a96b2815-3525-4eea-9ab4-14ba58e17835&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;0025f062-f684-4e02-9da2-3219e011ec74&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;SHUTOFF&#39;</span><span class="p">},</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flavor_name&#39;</span><span class="p">:</span> <span class="s1">&#39;m1.small&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;migration-vm&#39;</span><span class="p">,</span> <span class="s1">&#39;security_group_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;testing123&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;openstack.compute.Server&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Workload migration recorded demo:</p>
<p><a class="reference external" href="https://youtu.be/e7KXy5Hq4CMA"><img alt="Watch the video1" src="https://img.youtube.com/vi/e7KXy5Hq4CM/maxresdefault.jpg" /></a></p>
<p><a class="reference external" href="https://youtu.be/gEKvgIZqrQY"><img alt="Watch the video2" src="https://img.youtube.com/vi/gEKvgIZqrQY/maxresdefault.jpg" /></a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuring-variables.html" class="btn btn-neutral float-right" title="Configuring variables in os-migrate" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install-from-galaxy.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, os-migrate

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>